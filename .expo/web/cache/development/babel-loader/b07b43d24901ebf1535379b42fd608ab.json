{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport RNFetchBlob from \"../index.js\";\nimport XMLHttpRequestEventTarget from \"./XMLHttpRequestEventTarget.js\";\nimport Log from \"../utils/log.js\";\nimport Blob from \"./Blob.js\";\nimport ProgressEvent from \"./ProgressEvent.js\";\nimport URIUtil from \"../utils/uri\";\nvar log = new Log('XMLHttpRequest');\nlog.disable();\nvar UNSENT = 0;\nvar OPENED = 1;\nvar HEADERS_RECEIVED = 2;\nvar LOADING = 3;\nvar DONE = 4;\n\nvar XMLHttpRequest = function (_XMLHttpRequestEventT) {\n  _inherits(XMLHttpRequest, _XMLHttpRequestEventT);\n\n  var _super = _createSuper(XMLHttpRequest);\n\n  _createClass(XMLHttpRequest, [{\n    key: \"UNSENT\",\n    get: function get() {\n      return UNSENT;\n    }\n  }, {\n    key: \"OPENED\",\n    get: function get() {\n      return OPENED;\n    }\n  }, {\n    key: \"HEADERS_RECEIVED\",\n    get: function get() {\n      return HEADERS_RECEIVED;\n    }\n  }, {\n    key: \"LOADING\",\n    get: function get() {\n      return LOADING;\n    }\n  }, {\n    key: \"DONE\",\n    get: function get() {\n      return DONE;\n    }\n  }], [{\n    key: \"setLog\",\n    value: function setLog(level) {\n      if (level === -1) log.disable();else log.level(level);\n    }\n  }, {\n    key: \"addBinaryContentType\",\n    value: function addBinaryContentType(substr) {\n      for (var i in XMLHttpRequest.binaryContentTypes) {\n        if (new RegExp(substr, 'i').test(XMLHttpRequest.binaryContentTypes[i])) {\n          return;\n        }\n      }\n\n      XMLHttpRequest.binaryContentTypes.push(substr);\n    }\n  }, {\n    key: \"removeBinaryContentType\",\n    value: function removeBinaryContentType(val) {\n      for (var i in XMLHttpRequest.binaryContentTypes) {\n        if (new RegExp(substr, 'i').test(XMLHttpRequest.binaryContentTypes[i])) {\n          XMLHttpRequest.binaryContentTypes.splice(i, 1);\n          return;\n        }\n      }\n    }\n  }, {\n    key: \"UNSENT\",\n    get: function get() {\n      return UNSENT;\n    }\n  }, {\n    key: \"OPENED\",\n    get: function get() {\n      return OPENED;\n    }\n  }, {\n    key: \"HEADERS_RECEIVED\",\n    get: function get() {\n      return HEADERS_RECEIVED;\n    }\n  }, {\n    key: \"LOADING\",\n    get: function get() {\n      return LOADING;\n    }\n  }, {\n    key: \"DONE\",\n    get: function get() {\n      return DONE;\n    }\n  }]);\n\n  function XMLHttpRequest() {\n    var _this;\n\n    _classCallCheck(this, XMLHttpRequest);\n\n    log.verbose('XMLHttpRequest constructor called');\n    _this = _super.call(this);\n    _this.upload = new XMLHttpRequestEventTarget();\n    _this._readyState = UNSENT;\n    _this._uriType = 'net';\n    _this._response = '';\n    _this._responseText = '';\n    _this._responseHeaders = {};\n    _this._responseType = '';\n    _this._responseURL = '';\n    _this._responseXML = '';\n    _this._status = 0;\n    _this._statusText = '';\n    _this._timeout = 60000;\n    _this._sendFlag = false;\n    _this._uploadStarted = false;\n    _this._increment = false;\n    _this._config = {};\n    _this._headers = {\n      'Content-Type': 'text/plain'\n    };\n    _this._cleanUp = null;\n\n    _this._headerReceived = function (e) {\n      log.debug('header received ', _this._task.taskId, e);\n      _this.responseURL = _this._url;\n\n      if (e.state === \"2\" && e.taskId === _this._task.taskId) {\n        _this._responseHeaders = e.headers;\n        _this._statusText = e.status;\n        _this._status = Math.floor(e.status);\n\n        _this._dispatchReadStateChange(XMLHttpRequest.HEADERS_RECEIVED);\n      }\n    };\n\n    _this._uploadProgressEvent = function (send, total) {\n      if (!_this._uploadStarted) {\n        _this.upload.dispatchEvent('loadstart');\n\n        _this._uploadStarted = true;\n      }\n\n      if (send >= total) _this.upload.dispatchEvent('load');\n\n      _this.upload.dispatchEvent('progress', new ProgressEvent(true, send, total));\n    };\n\n    _this._progressEvent = function (send, total, chunk) {\n      log.verbose(_this.readyState);\n      if (_this._readyState === XMLHttpRequest.HEADERS_RECEIVED) _this._dispatchReadStateChange(XMLHttpRequest.LOADING);\n      var lengthComputable = false;\n      if (total && total >= 0) lengthComputable = true;\n      var e = new ProgressEvent(lengthComputable, send, total);\n\n      if (_this._increment) {\n        _this._responseText += chunk;\n      }\n\n      _this.dispatchEvent('progress', e);\n    };\n\n    _this._onError = function (err) {\n      var statusCode = Math.floor(_this.status);\n\n      if (statusCode >= 100 && statusCode !== 408) {\n        return;\n      }\n\n      log.debug('XMLHttpRequest error', err);\n      _this._statusText = err;\n      _this._status = String(err).match(/\\d+/);\n      _this._status = _this._status ? Math.floor(_this.status) : 404;\n\n      _this._dispatchReadStateChange(XMLHttpRequest.DONE);\n\n      if (err && String(err.message).match(/(timed\\sout|timedout)/) || _this._status == 408) {\n        _this.dispatchEvent('timeout');\n      }\n\n      _this.dispatchEvent('loadend');\n\n      _this.dispatchEvent('error', {\n        type: 'error',\n        detail: err\n      });\n\n      _this.clearEventListeners();\n    };\n\n    _this._onDone = function (resp) {\n      log.debug('XMLHttpRequest done', _this._url, resp, _assertThisInitialized(_this));\n      _this._statusText = _this._status;\n\n      var responseDataReady = function responseDataReady() {\n        log.debug('request done state = 4');\n\n        _this.dispatchEvent('load');\n\n        _this.dispatchEvent('loadend');\n\n        _this._dispatchReadStateChange(XMLHttpRequest.DONE);\n\n        _this.clearEventListeners();\n      };\n\n      if (resp) {\n        var info = resp.respInfo || {};\n        log.debug(_this._url, info, info.respType);\n\n        switch (_this._responseType) {\n          case 'blob':\n            resp.blob().then(function (b) {\n              _this._responseText = resp.text();\n              _this._response = b;\n              responseDataReady();\n            });\n            break;\n\n          case 'arraybuffer':\n            break;\n\n          case 'json':\n            _this._response = resp.json();\n            _this._responseText = resp.text();\n            break;\n\n          default:\n            _this._responseText = resp.text();\n            _this._response = _this.responseText;\n            responseDataReady();\n            break;\n        }\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(XMLHttpRequest, [{\n    key: \"open\",\n    value: function open(method, url, async, user, password) {\n      log.verbose('XMLHttpRequest open ', method, url, async, user, password);\n      this._method = method;\n      this._url = url;\n      this._headers = {};\n      this._increment = URIUtil.isJSONStreamURI(this._url);\n      this._url = this._url.replace(/^JSONStream\\:\\/\\//, '');\n\n      this._dispatchReadStateChange(XMLHttpRequest.OPENED);\n    }\n  }, {\n    key: \"send\",\n    value: function send(body) {\n      var _this2 = this;\n\n      this._body = body;\n      if (this._readyState !== XMLHttpRequest.OPENED) throw 'InvalidStateError : XMLHttpRequest is not opened yet.';\n      var promise = Promise.resolve();\n      this._sendFlag = true;\n      log.verbose('XMLHttpRequest send ', body);\n      var _method = this._method,\n          _url = this._url,\n          _headers = this._headers;\n      log.verbose('sending request with args', _method, _url, _headers, body);\n      log.verbose(typeof body, body instanceof FormData);\n\n      if (body instanceof Blob) {\n        log.debug('sending blob body', body._blobCreated);\n        promise = new Promise(function (resolve, reject) {\n          body.onCreated(function (blob) {\n            if (blob.isDerived) {\n              _this2._cleanUp = function () {\n                blob.close();\n              };\n            }\n\n            log.debug('body created send request');\n            body = RNFetchBlob.wrap(blob.getRNFetchBlobRef());\n            resolve();\n          });\n        });\n      } else if (typeof body === 'object') {\n        body = JSON.stringify(body);\n        promise = Promise.resolve();\n      } else {\n        body = body ? body.toString() : body;\n        promise = Promise.resolve();\n      }\n\n      promise.then(function () {\n        log.debug('send request invoke', body);\n\n        for (var h in _headers) {\n          _headers[h] = _headers[h].toString();\n        }\n\n        _this2._task = RNFetchBlob.config({\n          auto: true,\n          timeout: _this2._timeout,\n          increment: _this2._increment,\n          binaryContentTypes: XMLHttpRequest.binaryContentTypes\n        }).fetch(_method, _url, _headers, body);\n\n        _this2._task.stateChange(_this2._headerReceived).uploadProgress(_this2._uploadProgressEvent).progress(_this2._progressEvent).catch(_this2._onError).then(_this2._onDone);\n      });\n    }\n  }, {\n    key: \"overrideMimeType\",\n    value: function overrideMimeType(mime) {\n      log.verbose('XMLHttpRequest overrideMimeType', mime);\n      this._headers['Content-Type'] = mime;\n    }\n  }, {\n    key: \"setRequestHeader\",\n    value: function setRequestHeader(name, value) {\n      log.verbose('XMLHttpRequest set header', name, value);\n\n      if (this._readyState !== OPENED || this._sendFlag) {\n        throw \"InvalidStateError : Calling setRequestHeader in wrong state  \" + this._readyState;\n      }\n\n      if (typeof name !== 'string' || /[^\\u0000-\\u00ff]/.test(name)) {\n        throw 'TypeError : header field name should be a string';\n      }\n\n      var invalidPatterns = [/[\\(\\)\\>\\<\\@\\,\\:\\\\\\/\\[\\]\\?\\=\\}\\{\\s\\ \\u007f\\;\\t\\0\\v\\r]/, /tt/];\n\n      for (var i in invalidPatterns) {\n        if (invalidPatterns[i].test(name) || typeof name !== 'string') {\n          throw \"SyntaxError : Invalid header field name \" + name;\n        }\n      }\n\n      this._headers[name] = value;\n    }\n  }, {\n    key: \"abort\",\n    value: function abort() {\n      var _this3 = this;\n\n      log.verbose('XMLHttpRequest abort ');\n      if (!this._task) return;\n\n      this._task.cancel(function (err) {\n        var e = {\n          timeStamp: Date.now()\n        };\n        if (_this3.onabort) _this3.onabort();\n\n        if (err) {\n          e.detail = err;\n          e.type = 'error';\n\n          _this3.dispatchEvent('error', e);\n        } else {\n          e.type = 'abort';\n\n          _this3.dispatchEvent('abort', e);\n        }\n      });\n    }\n  }, {\n    key: \"getResponseHeader\",\n    value: function getResponseHeader(field) {\n      log.verbose('XMLHttpRequest get header', field, this._responseHeaders);\n      if (!this._responseHeaders) return null;\n      return this._responseHeaders[field] || this._responseHeaders[field.toLowerCase()] || null;\n    }\n  }, {\n    key: \"getAllResponseHeaders\",\n    value: function getAllResponseHeaders() {\n      log.verbose('XMLHttpRequest get all headers', this._responseHeaders);\n      if (!this._responseHeaders) return '';\n      var result = '';\n      var respHeaders = this.responseHeaders;\n\n      for (var i in respHeaders) {\n        result += i + \": \" + respHeaders[i] + String.fromCharCode(0x0D, 0x0A);\n      }\n\n      return result.substr(0, result.length - 2);\n    }\n  }, {\n    key: \"_dispatchReadStateChange\",\n    value: function _dispatchReadStateChange(state) {\n      this._readyState = state;\n      if (typeof this._onreadystatechange === 'function') this._onreadystatechange();\n    }\n  }, {\n    key: \"onreadystatechange\",\n    set: function set(fn) {\n      log.verbose('XMLHttpRequest set onreadystatechange', fn);\n      this._onreadystatechange = fn;\n    },\n    get: function get() {\n      return this._onreadystatechange;\n    }\n  }, {\n    key: \"readyState\",\n    get: function get() {\n      log.verbose('get readyState', this._readyState);\n      return this._readyState;\n    }\n  }, {\n    key: \"status\",\n    get: function get() {\n      log.verbose('get status', this._status);\n      return this._status;\n    }\n  }, {\n    key: \"statusText\",\n    get: function get() {\n      log.verbose('get statusText', this._statusText);\n      return this._statusText;\n    }\n  }, {\n    key: \"response\",\n    get: function get() {\n      log.verbose('get response', this._response);\n      return this._response;\n    }\n  }, {\n    key: \"responseText\",\n    get: function get() {\n      log.verbose('get responseText', this._responseText);\n      return this._responseText;\n    }\n  }, {\n    key: \"responseURL\",\n    get: function get() {\n      log.verbose('get responseURL', this._responseURL);\n      return this._responseURL;\n    }\n  }, {\n    key: \"responseHeaders\",\n    get: function get() {\n      log.verbose('get responseHeaders', this._responseHeaders);\n      return this._responseHeaders;\n    }\n  }, {\n    key: \"timeout\",\n    set: function set(val) {\n      this._timeout = val * 1000;\n      log.verbose('set timeout', this._timeout);\n    },\n    get: function get() {\n      log.verbose('get timeout', this._timeout);\n      return this._timeout;\n    }\n  }, {\n    key: \"responseType\",\n    set: function set(val) {\n      log.verbose('set response type', this._responseType);\n      this._responseType = val;\n    },\n    get: function get() {\n      log.verbose('get response type', this._responseType);\n      return this._responseType;\n    }\n  }], [{\n    key: \"isRNFBPolyfill\",\n    get: function get() {\n      return true;\n    }\n  }]);\n\n  return XMLHttpRequest;\n}(XMLHttpRequestEventTarget);\n\nXMLHttpRequest.binaryContentTypes = ['image/', 'video/', 'audio/'];\nexport { XMLHttpRequest as default };","map":{"version":3,"sources":["/home/thecoder/Documentos/votark/votark/node_modules/react-native-fetch-blob/polyfill/XMLHttpRequest.js"],"names":["RNFetchBlob","XMLHttpRequestEventTarget","Log","Blob","ProgressEvent","URIUtil","log","disable","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE","XMLHttpRequest","level","substr","i","binaryContentTypes","RegExp","test","push","val","splice","verbose","upload","_readyState","_uriType","_response","_responseText","_responseHeaders","_responseType","_responseURL","_responseXML","_status","_statusText","_timeout","_sendFlag","_uploadStarted","_increment","_config","_headers","_cleanUp","_headerReceived","e","debug","_task","taskId","responseURL","_url","state","headers","status","Math","floor","_dispatchReadStateChange","_uploadProgressEvent","send","total","dispatchEvent","_progressEvent","chunk","readyState","lengthComputable","_onError","err","statusCode","String","match","message","type","detail","clearEventListeners","_onDone","resp","responseDataReady","info","respInfo","respType","blob","then","b","text","json","responseText","method","url","async","user","password","_method","isJSONStreamURI","replace","body","_body","promise","Promise","resolve","FormData","_blobCreated","reject","onCreated","isDerived","close","wrap","getRNFetchBlobRef","JSON","stringify","toString","h","config","auto","timeout","increment","fetch","stateChange","uploadProgress","progress","catch","mime","name","value","invalidPatterns","cancel","timeStamp","Date","now","onabort","field","toLowerCase","result","respHeaders","responseHeaders","fromCharCode","length","_onreadystatechange","fn"],"mappings":"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","sourcesContent":["// Copyright 2016 wkh237@github. All rights reserved.\n// Use of this source code is governed by a MIT-style license that can be\n// found in the LICENSE file.\n\nimport RNFetchBlob from '../index.js'\nimport XMLHttpRequestEventTarget from './XMLHttpRequestEventTarget.js'\nimport Log from '../utils/log.js'\nimport Blob from './Blob.js'\nimport ProgressEvent from './ProgressEvent.js'\nimport URIUtil from '../utils/uri'\n\nconst log = new Log('XMLHttpRequest')\n\nlog.disable()\n// log.level(3)\n\nconst UNSENT = 0\nconst OPENED = 1\nconst HEADERS_RECEIVED = 2\nconst LOADING = 3\nconst DONE = 4\n\nexport default class XMLHttpRequest extends XMLHttpRequestEventTarget{\n\n  _onreadystatechange : () => void;\n\n  upload : XMLHttpRequestEventTarget = new XMLHttpRequestEventTarget();\n  static binaryContentTypes : Array<string> = [\n    'image/', 'video/', 'audio/'\n  ];\n\n  // readonly\n  _readyState : number = UNSENT;\n  _uriType : 'net' | 'file' = 'net';\n  _response : any = '';\n  _responseText : any = '';\n  _responseHeaders : any = {};\n  _responseType : '' | 'arraybuffer' | 'blob'  | 'json' | 'text' = '';\n  // TODO : not suppoted ATM\n  _responseURL : null = '';\n  _responseXML : null = '';\n  _status : number = 0;\n  _statusText : string = '';\n  _timeout : number = 60000;\n  _sendFlag : boolean = false;\n  _uploadStarted : boolean = false;\n  _increment : boolean = false;\n\n  // RNFetchBlob compatible data structure\n  _config : RNFetchBlobConfig = {};\n  _url : any;\n  _method : string;\n  _headers: any = {\n    'Content-Type' : 'text/plain'\n  };\n  _cleanUp : () => void = null;\n  _body: any;\n\n  // RNFetchBlob promise object, which has `progress`, `uploadProgress`, and\n  // `cancel` methods.\n  _task: any;\n\n  // constants\n  get UNSENT() { return UNSENT }\n  get OPENED() { return OPENED }\n  get HEADERS_RECEIVED() { return HEADERS_RECEIVED }\n  get LOADING() { return LOADING }\n  get DONE() { return DONE }\n\n  static get UNSENT() {\n    return UNSENT\n  }\n\n  static get OPENED() {\n    return OPENED\n  }\n\n  static get HEADERS_RECEIVED() {\n    return HEADERS_RECEIVED\n  }\n\n  static get LOADING() {\n    return LOADING\n  }\n\n  static get DONE() {\n    return DONE\n  }\n\n  static setLog(level:number) {\n    if(level === -1)\n      log.disable()\n    else\n      log.level(level)\n  }\n\n  static addBinaryContentType(substr:string) {\n    for(let i in XMLHttpRequest.binaryContentTypes) {\n      if(new RegExp(substr,'i').test(XMLHttpRequest.binaryContentTypes[i])) {\n        return\n      }\n    }\n    XMLHttpRequest.binaryContentTypes.push(substr)\n\n  }\n\n  static removeBinaryContentType(val) {\n    for(let i in XMLHttpRequest.binaryContentTypes) {\n      if(new RegExp(substr,'i').test(XMLHttpRequest.binaryContentTypes[i])) {\n        XMLHttpRequest.binaryContentTypes.splice(i,1)\n        return\n      }\n    }\n  }\n\n  constructor() {\n    log.verbose('XMLHttpRequest constructor called')\n    super()\n  }\n\n\n  /**\n   * XMLHttpRequest.open, always async, user and password not supported. When\n   * this method invoked, headers should becomes empty again.\n   * @param  {string} method Request method\n   * @param  {string} url Request URL\n   * @param  {true} async Always async\n   * @param  {any} user NOT SUPPORTED\n   * @param  {any} password NOT SUPPORTED\n   */\n  open(method:string, url:string, async:true, user:any, password:any) {\n    log.verbose('XMLHttpRequest open ', method, url, async, user, password)\n    this._method = method\n    this._url = url\n    this._headers = {}\n    this._increment = URIUtil.isJSONStreamURI(this._url)\n    this._url = this._url.replace(/^JSONStream\\:\\/\\//, '')\n    this._dispatchReadStateChange(XMLHttpRequest.OPENED)\n  }\n\n  /**\n   * Invoke this function to send HTTP request, and set body.\n   * @param  {any} body Body in RNfetchblob flavor\n   */\n  send(body) {\n\n    this._body = body\n\n    if(this._readyState !== XMLHttpRequest.OPENED)\n      throw 'InvalidStateError : XMLHttpRequest is not opened yet.'\n    let promise = Promise.resolve()\n    this._sendFlag = true\n    log.verbose('XMLHttpRequest send ', body)\n    let {_method, _url, _headers } = this\n    log.verbose('sending request with args', _method, _url, _headers, body)\n    log.verbose(typeof body, body instanceof FormData)\n\n    if(body instanceof Blob) {\n      log.debug('sending blob body', body._blobCreated)\n      promise = new Promise((resolve, reject) => {\n          body.onCreated((blob) => {\n            // when the blob is derived (not created by RN developer), the blob\n            // will be released after XMLHttpRequest sent\n            if(blob.isDerived) {\n              this._cleanUp = () => {\n                blob.close()\n              }\n            }\n            log.debug('body created send request')\n            body = RNFetchBlob.wrap(blob.getRNFetchBlobRef())\n            resolve()\n          })\n        })\n    }\n    else if(typeof body === 'object') {\n      body = JSON.stringify(body)\n      promise = Promise.resolve()\n    }\n    else {\n      body = body ? body.toString() : body\n      promise = Promise.resolve()\n    }\n\n    promise.then(() => {\n      log.debug('send request invoke', body)\n      for(let h in _headers) {\n        _headers[h] = _headers[h].toString()\n      }\n\n      this._task = RNFetchBlob\n                    .config({\n                      auto: true,\n                      timeout : this._timeout,\n                      increment : this._increment,\n                      binaryContentTypes : XMLHttpRequest.binaryContentTypes\n                    })\n                    .fetch(_method, _url, _headers, body)\n      this._task\n          .stateChange(this._headerReceived)\n          .uploadProgress(this._uploadProgressEvent)\n          .progress(this._progressEvent)\n          .catch(this._onError)\n          .then(this._onDone)\n\n    })\n  }\n\n  overrideMimeType(mime:string) {\n    log.verbose('XMLHttpRequest overrideMimeType', mime)\n    this._headers['Content-Type'] = mime\n  }\n\n  setRequestHeader(name, value) {\n    log.verbose('XMLHttpRequest set header', name, value)\n    if(this._readyState !== OPENED || this._sendFlag) {\n      throw `InvalidStateError : Calling setRequestHeader in wrong state  ${this._readyState}`\n    }\n    // UNICODE SHOULD NOT PASS\n    if(typeof name !== 'string' || /[^\\u0000-\\u00ff]/.test(name)) {\n      throw 'TypeError : header field name should be a string'\n    }\n    //\n    let invalidPatterns = [\n      /[\\(\\)\\>\\<\\@\\,\\:\\\\\\/\\[\\]\\?\\=\\}\\{\\s\\ \\u007f\\;\\t\\0\\v\\r]/,\n      /tt/\n    ]\n    for(let i in invalidPatterns) {\n      if(invalidPatterns[i].test(name) || typeof name !== 'string') {\n        throw `SyntaxError : Invalid header field name ${name}`\n      }\n    }\n    this._headers[name] = value\n  }\n\n  abort() {\n    log.verbose('XMLHttpRequest abort ')\n    if(!this._task)\n      return\n    this._task.cancel((err) => {\n      let e = {\n        timeStamp : Date.now(),\n      }\n      if(this.onabort)\n        this.onabort()\n      if(err) {\n        e.detail = err\n        e.type = 'error'\n        this.dispatchEvent('error', e)\n      }\n      else {\n        e.type = 'abort'\n        this.dispatchEvent('abort', e)\n      }\n    })\n  }\n\n  getResponseHeader(field:string):string | null {\n    log.verbose('XMLHttpRequest get header', field, this._responseHeaders)\n    if(!this._responseHeaders)\n      return null\n    return (this._responseHeaders[field] || this._responseHeaders[field.toLowerCase()]) || null\n\n  }\n\n  getAllResponseHeaders():string | null {\n    log.verbose('XMLHttpRequest get all headers', this._responseHeaders)\n    if(!this._responseHeaders)\n      return ''\n    let result = ''\n    let respHeaders = this.responseHeaders\n    for(let i in respHeaders) {\n      result += `${i}: ${respHeaders[i]}${String.fromCharCode(0x0D,0x0A)}`\n    }\n    return result.substr(0, result.length-2)\n  }\n\n  _headerReceived = (e) => {\n    log.debug('header received ', this._task.taskId, e)\n    this.responseURL = this._url\n    if(e.state === \"2\" && e.taskId === this._task.taskId) {\n      this._responseHeaders = e.headers\n      this._statusText = e.status\n      this._status = Math.floor(e.status)\n      this._dispatchReadStateChange(XMLHttpRequest.HEADERS_RECEIVED)\n    }\n  }\n\n  _uploadProgressEvent = (send:number, total:number) => {\n    if(!this._uploadStarted) {\n      this.upload.dispatchEvent('loadstart')\n      this._uploadStarted = true\n    }\n    if(send >= total)\n      this.upload.dispatchEvent('load')\n    this.upload.dispatchEvent('progress', new ProgressEvent(true, send, total))\n  }\n\n  _progressEvent = (send:number, total:number, chunk:string) => {\n    log.verbose(this.readyState)\n    if(this._readyState === XMLHttpRequest.HEADERS_RECEIVED)\n      this._dispatchReadStateChange(XMLHttpRequest.LOADING)\n    let lengthComputable = false\n    if(total && total >= 0)\n        lengthComputable = true\n    let e = new ProgressEvent(lengthComputable, send, total)\n\n    if(this._increment) {\n      this._responseText += chunk\n    }\n    this.dispatchEvent('progress', e)\n  }\n\n  _onError = (err) => {\n    let statusCode = Math.floor(this.status)\n    if(statusCode >= 100 && statusCode !== 408) {\n      return\n    }\n    log.debug('XMLHttpRequest error', err)\n    this._statusText = err\n    this._status = String(err).match(/\\d+/)\n    this._status = this._status ? Math.floor(this.status) : 404\n    this._dispatchReadStateChange(XMLHttpRequest.DONE)\n    if(err && String(err.message).match(/(timed\\sout|timedout)/) || this._status == 408) {\n      this.dispatchEvent('timeout')\n    }\n    this.dispatchEvent('loadend')\n    this.dispatchEvent('error', {\n      type : 'error',\n      detail : err\n    })\n    this.clearEventListeners()\n  }\n\n  _onDone = (resp) => {\n    log.debug('XMLHttpRequest done', this._url, resp, this)\n    this._statusText = this._status\n    let responseDataReady = () => {\n      log.debug('request done state = 4')\n      this.dispatchEvent('load')\n      this.dispatchEvent('loadend')\n      this._dispatchReadStateChange(XMLHttpRequest.DONE)\n      this.clearEventListeners()\n    }\n    if(resp) {\n      let info = resp.respInfo || {}\n      log.debug(this._url, info, info.respType)\n      switch(this._responseType) {\n        case 'blob' :\n          resp.blob().then((b) => {\n            this._responseText = resp.text()\n            this._response = b\n            responseDataReady()\n          })\n        break;\n        case 'arraybuffer':\n          // TODO : to array buffer\n        break\n        case 'json':\n          this._response = resp.json()\n          this._responseText = resp.text()\n        break\n        default :\n          this._responseText = resp.text()\n          this._response = this.responseText\n          responseDataReady()\n        break;\n      }\n    }\n\n  }\n\n  _dispatchReadStateChange(state) {\n    this._readyState = state\n    if(typeof this._onreadystatechange === 'function')\n      this._onreadystatechange()\n  }\n\n  set onreadystatechange(fn:() => void) {\n    log.verbose('XMLHttpRequest set onreadystatechange', fn)\n    this._onreadystatechange = fn\n  }\n\n  get onreadystatechange() {\n    return this._onreadystatechange\n  }\n\n  get readyState() {\n    log.verbose('get readyState', this._readyState)\n    return this._readyState\n  }\n\n  get status() {\n    log.verbose('get status', this._status)\n    return this._status\n  }\n\n  get statusText() {\n    log.verbose('get statusText', this._statusText)\n    return this._statusText\n  }\n\n  get response() {\n    log.verbose('get response', this._response)\n    return this._response\n  }\n\n  get responseText() {\n    log.verbose('get responseText', this._responseText)\n    return this._responseText\n  }\n\n  get responseURL() {\n    log.verbose('get responseURL', this._responseURL)\n    return this._responseURL\n  }\n\n  get responseHeaders() {\n    log.verbose('get responseHeaders', this._responseHeaders)\n    return this._responseHeaders\n  }\n\n  set timeout(val) {\n    this._timeout = val*1000\n    log.verbose('set timeout', this._timeout)\n  }\n\n  get timeout() {\n    log.verbose('get timeout', this._timeout)\n    return this._timeout\n  }\n\n  set responseType(val) {\n    log.verbose('set response type', this._responseType)\n    this._responseType = val\n  }\n\n  get responseType() {\n    log.verbose('get response type', this._responseType)\n    return this._responseType\n  }\n\n  static get isRNFBPolyfill() {\n    return true\n  }\n\n}\n"]},"metadata":{},"sourceType":"module"}