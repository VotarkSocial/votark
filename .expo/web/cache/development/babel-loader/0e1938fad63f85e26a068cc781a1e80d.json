{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nvar _marked = _regeneratorRuntime.mark(sendReport),\n    _marked2 = _regeneratorRuntime.mark(watchSendReport);\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { call, takeEvery, put, select } from 'redux-saga/effects';\nimport * as selectors from \"../reducers\";\nimport * as actions from \"../actions/report\";\nimport * as types from \"../types/report\";\nimport { API_URL } from \"../../configuration\";\nvar API_BASE_URL = API_URL + 'api/v1';\n\nfunction sendReport(action) {\n  var isAuth, userid, token, response, jsonResult, _yield$response$json, non_field_errors;\n\n  return _regeneratorRuntime.wrap(function sendReport$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return select(selectors.isAuthenticated);\n\n        case 3:\n          isAuth = _context.sent;\n          _context.next = 6;\n          return select(selectors.getAuthUserID);\n\n        case 6:\n          userid = _context.sent;\n\n          if (!isAuth) {\n            _context.next = 29;\n            break;\n          }\n\n          _context.next = 10;\n          return select(selectors.getAuthToken);\n\n        case 10:\n          token = _context.sent;\n          console.log(action.payload);\n          _context.next = 14;\n          return call(fetch, API_BASE_URL + \"/report/\", {\n            method: 'POST',\n            body: _objectSpread(_objectSpread({}, action.payload), {}, {\n              user: userid\n            }),\n            headers: {\n              'Content-Type': 'application/json',\n              'Authorization': \"JWT \" + token\n            }\n          });\n\n        case 14:\n          response = _context.sent;\n\n          if (!(response.status === 200)) {\n            _context.next = 23;\n            break;\n          }\n\n          _context.next = 18;\n          return response.json();\n\n        case 18:\n          jsonResult = _context.sent;\n          _context.next = 21;\n          return put(actions.completeSendingReport());\n\n        case 21:\n          _context.next = 29;\n          break;\n\n        case 23:\n          _context.next = 25;\n          return response.json();\n\n        case 25:\n          _yield$response$json = _context.sent;\n          non_field_errors = _yield$response$json.non_field_errors;\n          _context.next = 29;\n          return put(actions.failSendingReport(non_field_errors[0]));\n\n        case 29:\n          _context.next = 35;\n          break;\n\n        case 31:\n          _context.prev = 31;\n          _context.t0 = _context[\"catch\"](0);\n          _context.next = 35;\n          return put(actions.failSendingReport('CONNECTION FAILED'));\n\n        case 35:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[0, 31]]);\n}\n\nexport function watchSendReport() {\n  return _regeneratorRuntime.wrap(function watchSendReport$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return takeEvery(types.SEND_REPORT_STARTED, sendReport);\n\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}","map":{"version":3,"sources":["/home/thecoder/Documentos/votark/votark/src/sagas/report.js"],"names":["sendReport","watchSendReport","call","takeEvery","put","select","selectors","actions","types","API_URL","API_BASE_URL","action","isAuthenticated","isAuth","getAuthUserID","userid","getAuthToken","token","console","log","payload","fetch","method","body","user","headers","response","status","json","jsonResult","completeSendingReport","non_field_errors","failSendingReport","SEND_REPORT_STARTED"],"mappings":";;;uCAgBYA,U;wCAgCOC,e;;;;;;AAhDnB,SACIC,IADJ,EAEIC,SAFJ,EAGIC,GAHJ,EAMIC,MANJ,QAOS,oBAPT;AASA,OAAO,KAAKC,SAAZ;AACA,OAAO,KAAKC,OAAZ;AACA,OAAO,KAAKC,KAAZ;AACA,SAASC,OAAT;AAEE,IAAMC,YAAY,GAAID,OAAO,GAAG,QAAhC;;AAEA,SAAUT,UAAV,CAAqBW,MAArB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEqB,iBAAMN,MAAM,CAACC,SAAS,CAACM,eAAX,CAAZ;;AAFrB;AAEYC,UAAAA,MAFZ;AAAA;AAGqB,iBAAMR,MAAM,CAACC,SAAS,CAACQ,aAAX,CAAZ;;AAHrB;AAGYC,UAAAA,MAHZ;;AAAA,eAIUF,MAJV;AAAA;AAAA;AAAA;;AAAA;AAKsB,iBAAMR,MAAM,CAACC,SAAS,CAACU,YAAX,CAAZ;;AALtB;AAKcC,UAAAA,KALd;AAMQC,UAAAA,OAAO,CAACC,GAAR,CAAYR,MAAM,CAACS,OAAnB;AANR;AAOyB,iBAAMlB,IAAI,CACzBmB,KADyB,EAEtBX,YAFsB,eAGzB;AACEY,YAAAA,MAAM,EAAE,MADV;AAEEC,YAAAA,IAAI,kCAAMZ,MAAM,CAACS,OAAb;AAAqBI,cAAAA,IAAI,EAACT;AAA1B,cAFN;AAGEU,YAAAA,OAAO,EAAC;AACN,8BAAgB,kBADV;AAEN,wCAAwBR;AAFlB;AAHV,WAHyB,CAAV;;AAPzB;AAOcS,UAAAA,QAPd;;AAAA,gBAmBYA,QAAQ,CAACC,MAAT,KAAoB,GAnBhC;AAAA;AAAA;AAAA;;AAAA;AAoB6B,iBAAMD,QAAQ,CAACE,IAAT,EAAN;;AApB7B;AAoBgBC,UAAAA,UApBhB;AAAA;AAqBU,iBAAMzB,GAAG,CAACG,OAAO,CAACuB,qBAAR,EAAD,CAAT;;AArBV;AAAA;AAAA;;AAAA;AAAA;AAuBuC,iBAAMJ,QAAQ,CAACE,IAAT,EAAN;;AAvBvC;AAAA;AAuBkBG,UAAAA,gBAvBlB,wBAuBkBA,gBAvBlB;AAAA;AAwBU,iBAAM3B,GAAG,CAACG,OAAO,CAACyB,iBAAR,CAA0BD,gBAAgB,CAAC,CAAD,CAA1C,CAAD,CAAT;;AAxBV;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AA4BM,iBAAM3B,GAAG,CAACG,OAAO,CAACyB,iBAAR,CAA0B,mBAA1B,CAAD,CAAT;;AA5BN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgCA,OAAO,SAAU/B,eAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AACL,iBAAME,SAAS,CACbK,KAAK,CAACyB,mBADO,EAEbjC,UAFa,CAAf;;AADK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import {\n    call,\n    takeEvery,\n    put,\n    // race,\n    // all,\n    select,\n  } from 'redux-saga/effects';\n\nimport * as selectors from '../reducers';\nimport * as actions from '../actions/report';\nimport * as types from '../types/report';\nimport { API_URL } from '../../configuration';\n  \n  const API_BASE_URL =  API_URL + 'api/v1';\n  \n  function* sendReport(action) {\n    try {\n        const isAuth = yield select(selectors.isAuthenticated);\n        const userid = yield select(selectors.getAuthUserID)\n        if (isAuth) {\n          const token = yield select(selectors.getAuthToken);\n          console.log(action.payload)\n          const response = yield call(\n            fetch,\n            `${API_BASE_URL}/report/`,\n            {\n              method: 'POST',\n              body: {...action.payload,user:userid},\n              headers:{\n                'Content-Type': 'application/json',\n                'Authorization': `JWT ${token}`,\n              },\n            }\n          );\n          if (response.status === 200) {\n            const jsonResult = yield response.json();\n            yield put(actions.completeSendingReport());\n          } else {\n            const { non_field_errors } = yield response.json();\n            yield put(actions.failSendingReport(non_field_errors[0]));\n          }\n        }\n      } catch (error) {\n        yield put(actions.failSendingReport('CONNECTION FAILED'));\n      }\n  }\n  \n  export function* watchSendReport() {\n    yield takeEvery(\n      types.SEND_REPORT_STARTED,\n      sendReport,\n    );\n  }\n"]},"metadata":{},"sourceType":"module"}