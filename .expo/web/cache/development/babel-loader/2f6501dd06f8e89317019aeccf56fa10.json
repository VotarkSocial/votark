{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _marked = _regeneratorRuntime.mark(versusFetch),\n    _marked2 = _regeneratorRuntime.mark(watchVersusFetch),\n    _marked3 = _regeneratorRuntime.mark(voteFetch),\n    _marked4 = _regeneratorRuntime.mark(watchVoteFetch);\n\nimport { call, takeEvery, put, delay, select } from 'redux-saga/effects';\nimport * as selectors from \"../reducers\";\nimport * as actions from \"../actions/versus\";\nimport * as types from \"../types/versus\";\nimport { API_URL } from \"../../configuration\";\nimport { normalize } from 'normalizr';\nimport * as schemas from \"../schemas/versus\";\nimport { startExtraUserFollowFetch, startUserFollowFetch, setUser, setExtraUser } from \"../actions/user\";\nimport { startFetchinLike, startFetchinHeart } from \"../actions/reaction\";\nvar API_BASE_URL = API_URL + 'api/v1';\n\nfunction versusFetch(action) {\n  var isAuth, token, response, jsonResult, normalized, _yield$response$json, non_field_errors;\n\n  return _regeneratorRuntime.wrap(function versusFetch$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return select(selectors.isAuthenticated);\n\n        case 3:\n          isAuth = _context.sent;\n          console.log(\"hsdhh\");\n\n          if (!isAuth) {\n            _context.next = 41;\n            break;\n          }\n\n          _context.next = 8;\n          return select(selectors.getAuthToken);\n\n        case 8:\n          token = _context.sent;\n          _context.next = 11;\n          return call(fetch, API_BASE_URL + \"/user/versus/\", {\n            method: 'GET',\n            headers: {\n              'Content-Type': 'application/json',\n              'Authorization': \"JWT \" + token\n            }\n          });\n\n        case 11:\n          response = _context.sent;\n\n          if (!(response.status === 200)) {\n            _context.next = 35;\n            break;\n          }\n\n          _context.next = 15;\n          return response.json();\n\n        case 15:\n          jsonResult = _context.sent;\n          normalized = normalize(jsonResult, schemas.versuses);\n          _context.next = 19;\n          return put(actions.setNull());\n\n        case 19:\n          _context.next = 21;\n          return put(startFetchinHeart(normalized.result[0]));\n\n        case 21:\n          _context.next = 23;\n          return put(startFetchinLike(normalized.result[0]));\n\n        case 23:\n          _context.next = 25;\n          return put(startExtraUserFollowFetch(normalized.entities.versuses[normalized.result[0]].user1.id));\n\n        case 25:\n          _context.next = 27;\n          return put(startUserFollowFetch(normalized.entities.versuses[normalized.result[0]].user2.id));\n\n        case 27:\n          _context.next = 29;\n          return put(setUser(normalized.entities.versuses[normalized.result[0]].user1));\n\n        case 29:\n          _context.next = 31;\n          return put(setExtraUser(normalized.entities.versuses[normalized.result[0]].user2));\n\n        case 31:\n          _context.next = 33;\n          return put(actions.completeFetchingVersus(normalized.entities.versuses, normalized.result));\n\n        case 33:\n          _context.next = 41;\n          break;\n\n        case 35:\n          _context.next = 37;\n          return response.json();\n\n        case 37:\n          _yield$response$json = _context.sent;\n          non_field_errors = _yield$response$json.non_field_errors;\n          _context.next = 41;\n          return put(actions.failFetchingVersus(non_field_errors[0]));\n\n        case 41:\n          _context.next = 47;\n          break;\n\n        case 43:\n          _context.prev = 43;\n          _context.t0 = _context[\"catch\"](0);\n          _context.next = 47;\n          return put(actions.failFetchingVersus('NETWORK ERROR'));\n\n        case 47:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[0, 43]]);\n}\n\nexport function watchVersusFetch() {\n  return _regeneratorRuntime.wrap(function watchVersusFetch$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return takeEvery(types.VERSUS_FETCHING_STARTED, versusFetch);\n\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction voteFetch(action) {\n  var isAuth, versusid, token, user, response, versus, _yield$response$json2, non_field_errors;\n\n  return _regeneratorRuntime.wrap(function voteFetch$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return select(selectors.isAuthenticated);\n\n        case 3:\n          isAuth = _context3.sent;\n          _context3.next = 6;\n          return select(selectors.getLastSelected);\n\n        case 6:\n          versusid = _context3.sent;\n          console.log(extra_user);\n\n          if (!isAuth) {\n            _context3.next = 44;\n            break;\n          }\n\n          _context3.next = 11;\n          return select(selectors.getAuthToken);\n\n        case 11:\n          token = _context3.sent;\n          _context3.next = 14;\n          return select(selectors.getAuthUserID);\n\n        case 14:\n          user = _context3.sent;\n          _context3.next = 17;\n          return call(fetch, API_BASE_URL + \"/vote/\", {\n            method: 'POST',\n            body: JSON.stringify(_objectSpread(_objectSpread({}, action.payload), {}, {\n              user: user,\n              versus: versusid\n            })),\n            headers: {\n              'Content-Type': 'application/json',\n              'Authorization': \"JWT \" + token\n            }\n          });\n\n        case 17:\n          response = _context3.sent;\n          _context3.next = 20;\n          return select(selectors.getVersus);\n\n        case 20:\n          versus = _context3.sent;\n          _context3.next = 23;\n          return put(startFetchinHeart(versus.id));\n\n        case 23:\n          _context3.next = 25;\n          return put(startFetchinLike(versus.id));\n\n        case 25:\n          _context3.next = 27;\n          return put(setUser(versus.user1));\n\n        case 27:\n          _context3.next = 29;\n          return put(setExtraUser(versus.user2));\n\n        case 29:\n          _context3.next = 31;\n          return put(startExtraUserFollowFetch(versus.user2.id));\n\n        case 31:\n          _context3.next = 33;\n          return put(startUserFollowFetch(versus.user1.id));\n\n        case 33:\n          if (!(response.status === 201)) {\n            _context3.next = 38;\n            break;\n          }\n\n          _context3.next = 36;\n          return put(actions.completeVoteVersus(versus.id));\n\n        case 36:\n          _context3.next = 44;\n          break;\n\n        case 38:\n          _context3.next = 40;\n          return response.json();\n\n        case 40:\n          _yield$response$json2 = _context3.sent;\n          non_field_errors = _yield$response$json2.non_field_errors;\n          _context3.next = 44;\n          return put(actions.failVoteVersus(non_field_errors[0]));\n\n        case 44:\n          _context3.next = 50;\n          break;\n\n        case 46:\n          _context3.prev = 46;\n          _context3.t0 = _context3[\"catch\"](0);\n          _context3.next = 50;\n          return put(actions.failVoteVersus('NETWORK ERROR'));\n\n        case 50:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[0, 46]]);\n}\n\nexport function watchVoteFetch() {\n  return _regeneratorRuntime.wrap(function watchVoteFetch$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return takeEvery(types.VERSUS_VOTE_STARTED, voteFetch);\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}","map":{"version":3,"sources":["/home/thecoder/Documentos/votark/votark/src/sagas/versus.js"],"names":["versusFetch","watchVersusFetch","voteFetch","watchVoteFetch","call","takeEvery","put","delay","select","selectors","actions","types","API_URL","normalize","schemas","startExtraUserFollowFetch","startUserFollowFetch","setUser","setExtraUser","startFetchinLike","startFetchinHeart","API_BASE_URL","action","isAuthenticated","isAuth","console","log","getAuthToken","token","fetch","method","headers","response","status","json","jsonResult","normalized","versuses","setNull","result","entities","user1","id","user2","completeFetchingVersus","non_field_errors","failFetchingVersus","VERSUS_FETCHING_STARTED","getLastSelected","versusid","extra_user","getAuthUserID","user","body","JSON","stringify","payload","versus","getVersus","completeVoteVersus","failVoteVersus","VERSUS_VOTE_STARTED"],"mappings":"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","sourcesContent":["import {\n    call,\n    takeEvery,\n    put,\n    // race,\n    // all,\n    delay,\n    select,\n  } from 'redux-saga/effects';\n\nimport * as selectors from '../reducers';\nimport * as actions from '../actions/versus';\nimport * as types from '../types/versus';\nimport { API_URL } from '../../configuration';\nimport { normalize } from 'normalizr';\nimport * as schemas from '../schemas/versus';\nimport { startExtraUserFollowFetch, startUserFollowFetch, setUser, setExtraUser} from '../actions/user'\nimport { startFetchinLike, startFetchinHeart} from '../actions/reaction'\n  \n  const API_BASE_URL =  API_URL + 'api/v1';\n  \n  \n  function* versusFetch(action) {\n    try {\n        const isAuth = yield select(selectors.isAuthenticated);\n        console.log(\"hsdhh\")\n        if (isAuth) {\n          const token = yield select(selectors.getAuthToken);\n          const response = yield call(\n            fetch,\n            `${API_BASE_URL}/user/versus/`,\n            {\n              method: 'GET',\n              headers:{\n                'Content-Type': 'application/json',\n                'Authorization': `JWT ${token}`,\n              },\n            }\n          );\n          if (response.status === 200) {\n            const jsonResult = yield response.json();\n            const normalized = normalize(jsonResult, schemas.versuses);\n            yield put(actions.setNull())\n            yield put(startFetchinHeart(normalized.result[0]))\n            yield put(startFetchinLike(normalized.result[0]))\n            yield put(startExtraUserFollowFetch(normalized.entities.versuses[normalized.result[0]].user1.id))\n            yield put(startUserFollowFetch(normalized.entities.versuses[normalized.result[0]].user2.id))\n            yield put(setUser(normalized.entities.versuses[normalized.result[0]].user1))\n            yield put(setExtraUser(normalized.entities.versuses[normalized.result[0]].user2))\n            yield put(\n              actions.completeFetchingVersus(\n                  normalized.entities.versuses,\n                  normalized.result\n              ),\n              );\n             \n          } else {\n            const { non_field_errors } = yield response.json();\n            yield put(actions.failFetchingVersus(non_field_errors[0]));\n          }\n        }\n      } catch (error) {\n        yield put(actions.failFetchingVersus('NETWORK ERROR'));\n      }\n  }\n  \n  export function* watchVersusFetch() {\n    yield takeEvery(\n      types.VERSUS_FETCHING_STARTED,\n      versusFetch,\n    );\n  }\n\n    \n  function* voteFetch(action) {\n    try {\n        const isAuth = yield select(selectors.isAuthenticated);\n        const versusid = yield select(selectors.getLastSelected);\n        console.log(extra_user)\n        if (isAuth) {\n          const token = yield select(selectors.getAuthToken);\n          const user = yield select(selectors.getAuthUserID);\n          const response = yield call(\n            fetch,\n            `${API_BASE_URL}/vote/`,\n            {\n              method: 'POST',\n              body: JSON.stringify({...action.payload,user,versus:versusid}),\n              headers:{\n                'Content-Type': 'application/json',\n                'Authorization': `JWT ${token}`,\n              },\n            }\n          );\n\n          const versus = yield select(selectors.getVersus)\n          yield put(startFetchinHeart(versus.id))\n          yield put(startFetchinLike(versus.id))\n          yield put(setUser(versus.user1))\n          yield put(setExtraUser(versus.user2))\n          yield put(startExtraUserFollowFetch(versus.user2.id))\n          yield put(startUserFollowFetch(versus.user1.id))\n          if (response.status === 201) {\n            yield put(actions.completeVoteVersus(versus.id))\n          } else {\n            const { non_field_errors } = yield response.json();\n            yield put(actions.failVoteVersus(non_field_errors[0]));\n          }\n        }\n      } catch (error) {\n        yield put(actions.failVoteVersus('NETWORK ERROR'));\n      }\n  }\n  \n  export function* watchVoteFetch() {\n    yield takeEvery(\n      types.VERSUS_VOTE_STARTED,\n      voteFetch,\n    );\n  }"]},"metadata":{},"sourceType":"module"}